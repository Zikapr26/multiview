<script>
    const API_KEY = "AIzaSyCQq0x3oD1kOWt2ZNgIhD-Y75nxIK3Z2gI";
    
    // Lista oficial da Expedição baseada nos links enviados
    const CANAIS_MONITORADOS = [
        "UC-lHJZR3Gqxm24_Vd_AJ5Yw", // Richard Rasmussen
        "UC0uYV778E2GTo6W8U6u220w", // Rato Borrachudo
        "UCPY9OndS0GqL9YofV_8B9_w", // Renato Cariani
        "UCxI-mD7-S1vshLh9LpX8Oog", // ACF Performance
        "UCX9H70qU1R3eK3c9NnOasTg", // Tonimek
        "UC57f9p_v0m3Gq80M09Hl_Bg"  // Gordox
    ];

    async function syncYoutube() {
        const btn = document.querySelector('.btn-sync');
        btn.innerText = "BUSCANDO LIVES...";
        btn.style.background = "#ffaa00";
        
        // Limpa os campos antes da nova busca
        for(let i=1; i<=6; i++) document.getElementById('in'+i).value = "";

        let encontradas = 0;

        for (const channelId of CANAIS_MONITORADOS) {
            try {
                // Busca se o canal está em live agora
                const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&type=video&eventType=live&key=${API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.items && data.items.length > 0 && encontradas < 6) {
                    encontradas++;
                    const videoId = data.items[0].id.videoId;
                    document.getElementById('in' + encontradas).value = `https://www.youtube.com/watch?v=${videoId}`;
                }
            } catch (e) { 
                console.error("Erro na API para o canal: " + channelId); 
            }
        }

        if (encontradas > 0) {
            carregar(); // Atualiza os iframes
            alert(encontradas + " lives encontradas e carregadas!");
        } else {
            alert("Nenhum desses canais está em live no momento.");
        }
        
        btn.innerText = "SYNC HELIOS";
        btn.style.background = "#0055ff";
    }

    // Ajuste no Layout para o modo 3 (2 em cima, 1 embaixo centralizado)
    function setLayout(n) {
        const rowUp = document.getElementById('row-up');
        const rowDown = document.getElementById('row-down');
        const allBoxes = document.querySelectorAll('.video-box');
        
        // Reset inicial: esconde tudo
        allBoxes.forEach(box => box.classList.add('hide'));
        rowUp.style.display = "flex";
        rowDown.style.display = "flex";

        if(n === 6) {
            // Mostra todos que tiverem link
            for(let i=1; i<=6; i++) {
                if(document.getElementById('in'+i).value) {
                    document.getElementById('b'+i).classList.remove('hide');
                    document.getElementById('b'+i).style.flex = "1";
                }
            }
        } 
        else if(n === 3) {
            // 2 em cima, 1 embaixo
            document.getElementById('b1').classList.remove('hide');
            document.getElementById('b2').classList.remove('hide');
            document.getElementById('b4').classList.remove('hide');
            document.getElementById('b4').style.flex = "2"; // Ocupa mais espaço embaixo
        }
        else if(n === 4) {
            // Grade clássica 2x2
            document.getElementById('b1').classList.remove('hide');
            document.getElementById('b2').classList.remove('hide');
            document.getElementById('b4').classList.remove('hide');
            document.getElementById('b5').classList.remove('hide');
        }
    }
</script>
